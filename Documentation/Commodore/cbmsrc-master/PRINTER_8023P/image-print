;**************************
;* IMAGE PRINT SUB        *
;**************************
;
INSER1
	LDY #0
	LDA DATA
	STA (POSI)Y
	JSR CINC
	JSR TRN
	JSR CCMP
	BCS IS10
IS65	JSR RMVEO
	TXA
	BEQ IS40
	LDA CRPOS
	ORA CRPOS+1
	BEQ IS60
	JSR HOME
IS60	LDA #22
	STA TSTATE
	LDA #$80
	STA CTRAVL
	JSR SPRINT
	JMP IS30
IS40
	LDA #1
	STA NFEEDS
	LDA #$80
	STA FTRA
	JSR PFSTRT
IS30	LDA PTRRDY
	BNE IS30
IS50	JSR ZERO
	LDA #$FF
	STA ONE
	SEC
	RTS
IS10	CLC
	RTS
;
;
RMVEO
	LDY #0
	LDA (POSI1)Y
	STA DATA1
	JSR CINC1
	JSR TRN1
	JSR CCMP1
	BCS REE10
	JSR ZERO1
	LDA TEMP5
	STA LIMPOS
	LDA TEMP5+1
	STA LIMPOS+1
	LDX #0
	RTS
REE10	LDX #255
	RTS
;
;
;
IMAGE	JSR CHAGP
IM502	LDA CONTRL
	BMI IM40
IM500	LDA #0
	STA CRPOS
	STA CRPOS+1
	JMP IRQEND
IM40	LDA CRPOS
	ORA CRPOS+1
	BNE IM50
	LDA TEST1
	ASL A
	ASL A
	BMI IM500
IM50	JSR COUNT
	LDA DATA1
	STA DOTDAT
	EOR #$FF
	STA NEEDLS
	LDA PORTB
	AND #$FE
	STA PORTB
	LDA #NDTIME
	STA NDCLKD
	STA NDCLKE
	CLI
IM10	LDA NDCLKE
	BMI IM20
	CMP #NDTIME-12
	BCS IM10
	LDA PORTB
	ORA #$01
	STA PORTB
	LDA DOTDAT
	TAY
	AND #$0F
	TAX
	LDA DOTNUM,X
	STA DOTDAT
	TYA
	LSR A
	LSR A
	LSR A
	LSR A
	TAX
	LDA DOTNUM,X
	CLC
	ADC DOTDAT
	STA ACCB
	LDA #0
	STA ACCB+1
	LDA DOT
	STA ACCA
	LDA DOT+1
	STA ACCA+1
	JSR ADDAB
	LDA ACCA
	STA DOT
	LDA ACCA+1
	STA DOT+1
IM20	JSR RMVEO
	TXA
	BEQ IM30
	JMP IRQEND
IM30	LDA NOLF
	BNE IM333
	LDA #1
	STA NFEEDS
	LDA #$80
	STA FTRA
IM333	LDA #$83
	STA SPBYTE
	LDA #0
	STA NOLF
	LDX #16
	STX STOP
	JSR CRSET
	JMP IRQEND
;
CINC	LDA POSI
	STA ACCA
	LDA POSI+1
	STA ACCA+1
CI10	LDA #1
	STA ACCB
	LDA #0
	STA ACCB+1
	JSR ADDAB
	RTS
;
CINC1	LDA POSI1
	STA ACCA
	LDA POSI1+1
	STA ACCA+1
	JMP CI10
;
TRN	LDA ACCA
	STA POSI
	LDA ACCA+1
	STA POSI+1
	RTS
TRN1	LDA ACCA
	STA POSI1
	LDA ACCA+1
	STA POSI1+1
	RTS
CCMP
	LDA POSI
	STA ACCB
	LDA POSI+1
	STA ACCB+1
CC10	LDA LIMPOS
	STA ACCA
	LDA LIMPOS+1
	STA ACCA+1
	JSR COMP
	RTS
;
CCMP1	LDA POSI1
	STA ACCB
	LDA POSI1+1
	STA ACCB+1
	JMP CC10
;
ZERO
	LDA #<BUF
	STA POSI
	LDA #>BUF
	STA POSI+1
	RTS
;
ZERO1
	LDA #<BUF
	STA POSI1
	LDA #>BUF
	STA POSI1+1
	RTS
;
;
CLRMR	JSR ZERO1
	LDY #0
CLR10	TYA
	STA (POSI1)Y
	JSR CINC1
	JSR TRN1
	JSR CCMP1
	BCS CLR10
	JSR ZERO1
	RTS
;
	.END
