	.PAGE 'FORMFEED'
PAGEHD
	LDA LC
PH2
	LDX PTRRDY
	BNE PH2 ;WAIT FOR READY
;
	STA NFEEDS ;SET # LINEFEEDS
;
;START FEED
	LDA #$80
	STA FTRA
	JMP PFSTRT
;JSR/RTS
;
; FORM FEED TEST
;
FFTEST
	LDA PTRRDY
	BNE FF11
	LDA #FEEDSW
	BIT CONTRL
	BNE FF10 ;FEED SWITCH IS OFF
	BIT CONTRL ;CHECK AGAIN
	BEQ FORM ;FEED SWITCH IS ON
FF10	;CAN'T DO IT
	LDA PORTB
	AND #$08
	BNE FF11
FF99	JSR WAIT
	LDA PORTB
	AND #$08
	BNE FF11
	LDA #$80
	STA FTRA
FF13	LDA #4
	STA FDINC
FF15
	LDA #1
	STA NFEEDS
	JSR PFSTRT
	LDA #12
	STA FDINC
	JSR WAIT1
	JSR WAIT1
	JSR WAIT1
	JSR WAIT1
	RTS
;FF11 BVS FF12
;JSR WAIT
;FF98 BIT PORTB
;BVS FF12
;LDA #$7F
;STA FTRA
;BNE FF13
;FF12
;LDA PORTB
;ASL A
;ASL A
;BMI FF14
;JSR WAIT
;FF97 LDA PORTB
;ASL A
;ASL A
;BMI FF14
;LDA #$80
;STA FTRA
;LDA #12
;STA FDINC
;BNE FF15
;FF14 RTS
FF11	RTS
FORM	;DO A TOP OF FORM
	LDA LC
	BMI F10 ;PAGING IS OFF
;
	LDX LP ;USE # LINES/PAGE
	STX LC
	CLC
	ADC #6 ;ADD IN PAGE BREAK
F10
	AND #$7F
	JSR PH2 ;START TOF
	LDA LC
	BPL F20 ;PAGING ON
	LDA LP ;RESET TOP OF FORM COUNT
	CLC
	ADC #$86 ;ADD IN OFF FLAG & BREAK
	STA LC
F20
	RTS
;
;
;
;
;
;
WAIT
	LDA #<CHTDAT
	STA CRCLK
	LDA #>CHTDAT
	STA CRCLK+1
W10	LDA CRCLK+9
	AND #$40
	BEQ W10
	RTS
WAIT1	LDA #<WTIME
	STA CRCLK
	LDA #>WTIME
	STA CRCLK+1
	JMP W10
;
;
	.END
