.PAG 'ESCAPE - 05/02/83'
;************************************************************
;*
;*  ROUTINES INVOLVED IN EXECUTING ESCAPE FUNCTIONS
;*
;************************************************************
.SKI 2
;MAIN ESCAPE SEQUENCE HANDLER
;  ENTRY: CHARACTER FOLLOWING ESCAPE CHARACTER IN ACC.
ESCAPE
     AND #$7F
     SEC
     SBC #'A  ;TABLE BEGINS AT ASCII A
     CMP #$1A   ;'Z'-'A'+1
     BCC ESCGO ;VALID CHAR, GO GET ADDRESS
ESCRTS	RTS             ;FAILED TO FIND ENTRY...IGNORE IT!
.SKIP
ESCGO	;GET ADDRESS OF ESCAPE ROUTINE, AND GO TO IT.
     ASL A ;MULTIPLY INDEX BY 2
     TAX
     LDA ESCVCT+1,X  ;GET HIGH BYTE
     PHA
     LDA ESCVCT,X  ;AND LOW
     PHA
     RTS  ;AND GO TO THAT ADDRESS
.SKI 3
ESCVCT
  .WORD AUTON-1  ;A AUTO INSERT
  .WORD SETHTB-1 ;B SET BOTTOM
  .WORD AUTOFF-1 ;C CANCEL AUTO INSERT
  .WORD DLINE-1  ;D DELETE LINE
  .WORD SETCR4-1 ;E SELECT NON-FLASHING CURSOR
  .WORD SETCR2-1 ;F FLASHING CURSOR
  .WORD BELLON-1 ;G ENABLE BELL
  .WORD BELLOF-1 ;H DISABLE BELL
  .WORD ILINE-1  ;I INSERT LINE
  .WORD FNDFST-1 ;J MOVE TO START OF LINE
  .WORD FNDEND-1 ;K MOVE TO END OF LINE
  .WORD SCRSW0-1 ;L ENABLE SCROLLING
  .WORD SCRSW1-1 ;M DISABLE SCROLLING
  .WORD NRMSCR-1 ;N NORMAL SCREEN (NOT REVERSE)
  .WORD TOQM-1   ;O CANCEL INSERT,QUOTE, AND REVERSE
  .WORD ETOSOL-1 ;P ERASE TO START OF LINE
  .WORD ETOEOL-1 ;Q ERASE TO END OF LINE
  .WORD REVSCR-1 ;R REVERSE SCREEN
  .WORD SETCR3-1 ;S SOLID CURSOR (NOT UNDERSCORE)
  .WORD SETHTT-1 ;T SET TOP OF PAGE
  .WORD SETCR1-1 ;U UNDERSCORE CURSOR
  .WORD SUUP-1   ;V SCROLL UP
  .WORD SDDN-1   ;W SCROLL DOWN
  .WORD ESCRTS-1 ;X CANCEL ESCAPE SEQUENCE
  .WORD NRMSET-1 ;Y NORMAL CHARACTER SET
  .WORD ALTSET-1 ;Z ALTERNATE CHARACTER SET
.SKIP
;SET TOP OR BOTTOM
SETHTT
    CLC
    .BYTE $24
SETHTB
    SEC
WINDOW	LDX PNTR
     LDA TBLX
     BCC SETTOP
SETBOT
     STA SCBOT
     STX SCRT
     RTS
SRESET
     LDA #SCYMAX ;MAX # OF ROWS
     LDX #SCXMAX ;MAX # OF COLUMNS
     JSR SETBOT
     LDA #0
     TAX
SETTOP
     STA SCTOP
     STX SCLF
     RTS
.SKI
; TURN BELL ON OR OFF
BELLON
     LDA #0
BELLOF
     STA BELLMD
     RTS
.SKIP 3
;ALTER SCREEN OR CURSOR
SETCR1	;UNDERSCORE CURSOR
	LDA #$0B
	BIT TPI2+PC     ;CHECK MACHINE TYPE
	BMI SETUNS      ;BUIT-IN DISPLAY
	LDA #$06        ;ON OTHERS START CURSOR ON LINE 6
     .BYTE $2C
SETCR2	;FLASHING CURSOR
     LDA #$60
SETUNS
     ORA CONFIG
     BNE SETCR5 ;ALWAYS
SETCR3	;FULL CURSOR
     LDA #$F0
     .BYTE $2C
SETCR4	;STEADY CURSOR
     LDA #$0F
     AND CONFIG
SETCR5	STA CONFIG
     RTS ;WAIT UNTILL CURSOR ON TO UPDATE
.SKIP
REVSCR	;REVERSE SCREEN IMAGE
     LDA #$20
     .BYTE $2C
ALTSET	;ALTERNATE CHARACTER SET
     LDA #$10
     LDX #14
     STX VDC+ADREG
     ORA VDC+DAREG
     BNE SETSCR ;ALWAYS
NRMSCR	;NON-REVERSE SCREEN
     LDA #$DF
     .BYTE $2C
NRMSET	;NORMAL CHARACTER SET
     LDA #$EF
     LDX #14
     STX VDC+ADREG
     AND VDC+DAREG
SETSCR
     STA VDC+DAREG
     AND #$30 ;USE ONLY BITS 4 & 5 FOR STARTING ADDRESS HIGH
     LDX #12
CH6845
     STX VDC+ADREG
     STA VDC+DAREG
     RTS
.SKIP 3
;AUTO INSERT ON/OFF
AUTOFF
     LDA #0
     .BYTE $2C
AUTON
     LDA #$FF
     STA INSFLG
     RTS
.SKI
.END
